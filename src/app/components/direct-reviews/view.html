<div class="direct-reviews">
  <div ng-if="!$ctrl.directReviews || $ctrl.directReviews.length === 0">
    No Direct Reviews have been conducted
  </div>
  <div ng-repeat="dr in $ctrl.directReviews" class="direct-review panel-ai">
    <div class="direct-review__header panel-heading" ng-class="dr.endDate ? 'direct-review__header--closed' : 'direct-review__header--open'" ng-click="dr.open = !dr.open">
      <div class="direct-review__header-title">{{ dr.endDate ? 'Closed' : 'Open' }} Direct Review</div>
      <div class="direct-review__header-subtitle">{{ dr.endDate ? 'ended ' + $ctrl.DateUtil.getDisplayDateFormat(dr.endDate) : dr.startDate ? 'began ' + $ctrl.DateUtil.getDisplayDateFormat(dr.startDate) : 'has not started' }}</div>
      <div class="direct-review__header-nc-summary">{{ dr.ncSummary }}</div>
      <div class="direct-review__header-toggle"><i class="fa fa-lg" ng-class="dr.open ? 'fa-caret-down' : 'fa-caret-left'"></i></div>
    </div>
    <div class="panel-body" ng-if="dr.open">
      <div ng-if="!dr.nonConformities || dr.nonConformities.length === 0">
        Has not been determined
      </div>
      <div ng-if="dr.nonConformities && dr.nonConformities.length > 0">
        <table class="table table-responsive">
          <thead>
            <tr>
              <th scope="col">
                Non-Conformity Type <button class="tooltip-button btn btn-link" uib-tooltip="Type of non-conformity found during review" tooltip-trigger="'mouseenter focus click'"><span class="sr-only">Type of non-conformity found during review</span><i class="fa fa-info-circle"></i></button>
              </th>
              <th scope="col">
                Developer Associated Listings <button class="tooltip-button btn btn-link" uib-tooltip="A listing of other certified products associated with the non-conformity, as applicable" tooltip-trigger="'mouseenter focus click'"><span class="sr-only">A listing of other certified products associated with the non-conformity, as applicable</span><i class="fa fa-info-circle"></i></button>
              </th>
              <th scope="col">
                Corrective Action Plan Approval Date <button class="tooltip-button btn btn-link" uib-tooltip="The date that ONC approved the corrective action plan proposed by the developer" tooltip-trigger="'mouseenter focus click'"><span class="sr-only">The date that ONC approved the corrective action plan proposed by the developer</span><i class="fa fa-info-circle"></i></button>
              </th>
              <th scope="col">
                Date Corrective Action Must Be Completed <button class="tooltip-button btn btn-link" uib-tooltip="The date that the corrective action must be completed in order to avoid termination of the certified product’s certification status and/or a certification ban of the developer, as applicable" tooltip-trigger="'mouseenter focus click'"><span class="sr-only">The date that the corrective action must be completed in order to avoid termination of the certified product’s certification status and/or a certification ban of the developer, as applicable</span><i class="fa fa-info-circle"></i></button>
              </th>
              <th scope="col">
                Date Corrective Action Was Completed <button class="tooltip-button btn btn-link" uib-tooltip="The date the corrective action was completed" tooltip-trigger="'mouseenter focus click'"><span class="sr-only">The date the corrective action was completed</span><i class="fa fa-info-circle"></i></button>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="nc in dr.nonConformities">
              <td>{{ nc.nonConformityType ? nc.nonConformityType : 'Has not been determined' }}</td>
              <td>
                <span ng-if="!nc.developerAssociatedListings || nc.developerAssociatedListings.length === 0">None</span>
                <ul ng-if="nc.developerAssociatedListings && nc.developerAssociatedListings.length > 0">
                  <li ng-repeat="dal in nc.developerAssociatedListings">
                    <a ui-sref="listing({id: dal.id, panel: 'directReviews'})">{{ dal.chplProductNumber }}</a>
                  </li>
                </ul>
              </td>
              <td>{{ nc.friendlyCapApprovalDate }}</td>
              <td>{{ nc.friendlyCapMustCompleteDate }}</td>
              <td>{{ nc.friendlyCapEndDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>
